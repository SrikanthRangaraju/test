import java.io.*;
import java.nio.file.*;
import java.util.*;
import java.util.stream.Collectors;

public class FilterColumnsInCSV {

    public static void main(String[] args) throws IOException {
        // File paths
        String csvFilePath = "data.csv"; // Replace with your CSV file path
        String txtFilePath = "columns_to_keep.txt"; // Replace with your text file path
        String outputFilePath = "filtered_output.csv"; // Output CSV file

        // Read columns to keep from the text file (case-insensitive)
        Set<String> columnsToKeep = Files.lines(Paths.get(txtFilePath))
                                         .map(String::toLowerCase)
                                         .collect(Collectors.toSet());

        // Read the CSV file
        try (BufferedReader reader = new BufferedReader(new FileReader(csvFilePath));
             BufferedWriter writer = new BufferedWriter(new FileWriter(outputFilePath))) {

            String headerLine = reader.readLine();
            if (headerLine == null) {
                throw new IOException("CSV file is empty");
            }

            // Split header and identify columns to retain
            String[] headers = headerLine.split(",");
            List<Integer> columnsToRetain = new ArrayList<>();
            for (int i = 0; i < headers.length; i++) {
                if (columnsToKeep.contains(headers[i].toLowerCase())) {
                    columnsToRetain.add(i);
                }
            }

            // Write the new header
            writer.write(columnsToRetain.stream()
                                        .map(i -> headers[i])
                                        .collect(Collectors.joining(",")));
            writer.newLine();

            // Write the filtered rows
            String line;
            while ((line = reader.readLine()) != null) {
                String[] values = line.split(",");
                String filteredLine = columnsToRetain.stream()
                                                     .map(i -> values[i])
                                                     .collect(Collectors.joining(","));
                writer.write(filteredLine);
                writer.newLine();
            }
        }

        System.out.println("Filtered CSV file written to: " + outputFilePath);
    }
}
