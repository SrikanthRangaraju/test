import java.io.*;
import java.nio.file.*;
import java.util.regex.*;

public class ExtractSubjectData {

    public static void main(String[] args) throws IOException {
        String inputDir = "C:\\path\\to\\input\\folder";     // e.g., "C:\\Users\\srranga\\Downloads\\RUT_DATA_7_04_25"
        String outputDir = "C:\\path\\to\\output\\folder";   // e.g., "C:\\Users\\srranga\\Downloads\\ExtractedSubjectData"

        // Create output directory if it doesn't exist
        Files.createDirectories(Paths.get(outputDir));

        File folder = new File(inputDir);
        File[] files = folder.listFiles((dir, name) -> name.endsWith(".txt"));

        if (files == null || files.length == 0) {
            System.out.println("No .txt files found in input folder.");
            return;
        }

        // Regex
        Pattern pattern = Pattern.compile("\"aD\"\\s*:\\s*\\{(.*?)\\}", Pattern.DOTALL);

        for (File file : files) {
            String content = Files.readString(file.toPath());

            Matcher matcher = pattern.matcher(content);
            if (matcher.find()) {
                String subjectDataBlock = matcher.group(1);

                // Optional: clean any trailing commas or extra keys
                Pattern innerPattern = Pattern.compile("\"ad\"\\s*:\\s*\"(.*?)\".*?\"df\"\\s*:\\s*\"(.*?)\"", Pattern.DOTALL);
                Matcher innerMatcher = innerPattern.matcher(subjectDataBlock);

                if (innerMatcher.find()) {
                    String chileCredit = innerMatcher.group(1);
                    String chileRaw = innerMatcher.group(2);

                    String output = "{\n" +
                            "  \"ad\": \"" + ad + "\",\n" +
                            "  \"df\": \"" + sf + "\"\n" +
                            "}";

                    // Write to new file in output folder
                    Path outputPath = Paths.get(outputDir, file.getName());
                    Files.writeString(outputPath, output);

                    System.out.println("Extracted subjectData written to: " + outputPath.getFileName());
                } else {
                    System.out.println("ChileCreditData or ad missing in file: " + file.getName());
                }
            } else {
                System.out.println("No subjectData found in file: " + file.getName());
            }
        }
    }
}
