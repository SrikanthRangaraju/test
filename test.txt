import java.io.*;

public class CleanCSVSpecificColumn {

    public static void main(String[] args) {
        String inputFilePath = "path/to/input.csv"; // Replace with your actual file path
        String outputFilePath = "path/to/output.csv"; // Replace with your desired output file path
        String targetColumn = "EMISOR"; // Replace with the column name you want to clean

        try {
            // Read the input file
            BufferedReader reader = new BufferedReader(new FileReader(inputFilePath));
            StringBuilder outputContent = new StringBuilder();

            // Read the header line
            String headerLine = reader.readLine();
            if (headerLine == null) {
                System.out.println("The file is empty.");
                return;
            }
            outputContent.append(headerLine).append("\n");

            // Get column index for the target column
            String[] headers = headerLine.split(",(?=([^\"]*\"[^\"]*\")*[^\"]*$)"); // Handles quoted headers
            for (int i = 0; i < headers.length; i++) {
                headers[i] = headers[i].replaceAll("^\"|\"$", "").trim(); // Remove surrounding quotes and trim
            }

            int columnIndex = -1;
            for (int i = 0; i < headers.length; i++) {
                if (headers[i].equalsIgnoreCase(targetColumn)) {
                    columnIndex = i;
                    break;
                }
            }

            if (columnIndex == -1) {
                System.out.println("Target column not found.");
                return;
            }

            // Process each row
            String line;
            while ((line = reader.readLine()) != null) {
                String[] values = line.split(",(?=([^\"]*\"[^\"]*\")*[^\"]*$)", -1); // Handle quoted fields
                if (columnIndex < values.length) {
                    // Clean the specific column value by reducing spaces to one and cleaning up spaces around '|'
                    values[columnIndex] = values[columnIndex]
                            .replaceAll("\\s{2,}", " ") // Replace multiple spaces with a single space
                            .replace(" | ", "|"); // Remove spaces around the pipe symbol
                }
                outputContent.append(String.join(",", values)).append("\n");
            }
            reader.close();

            // Write the output to a new file
            BufferedWriter writer = new BufferedWriter(new FileWriter(outputFilePath));
            writer.write(outputContent.toString());
            writer.close();

            System.out.println("Processing complete. Output saved to: " + outputFilePath);

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
