WITH common_ruts AS (
  -- Get RUTs present in ALL 6 tables for camada = 202311
  SELECT rut FROM chile_bic WHERE camada = 202311
  INTERSECT
  SELECT rut FROM chile_mcc WHERE camada = 202311
  INTERSECT
  SELECT rut FROM chile_mtu WHERE camada = 202311
  INTERSECT
  SELECT rut FROM attr_bic WHERE camada = 202311
  INTERSECT
  SELECT rut FROM attr_mcc WHERE camada = 202311
  INTERSECT
  SELECT rut FROM attr_mtu WHERE camada = 202311
)

SELECT
  cr.rut,  -- Distinct RUT from the common set
  ab.bic_cant_doc_3um,
  am.mcc_cant_doc_3um,
  am.mcc_avg_monto,
  am.mcc_max_monto,
  amt.mtu_cant_doc_3um
FROM common_ruts cr
JOIN attr_bic ab 
  ON cr.rut = ab.rut 
  AND ab.camada = 202311  -- Filter by camada
JOIN attr_mcc am 
  ON cr.rut = am.rut 
  AND am.camada = 202311  -- Filter by camada
JOIN attr_mtu amt 
  ON cr.rut = amt.rut 
  AND amt.camada = 202311; -- Filter by camada
