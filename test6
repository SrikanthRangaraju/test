DO $$ 
DECLARE 
    r RECORD;
BEGIN
    FOR r IN 
        (SELECT tablename FROM pg_tables WHERE schemaname = 'test1') 
    LOOP
        EXECUTE format('CREATE TABLE test2.%I AS TABLE test1.%I WITH NO DATA', r.tablename, r.tablename);
    END LOOP;
END $$;


DO $$ 
DECLARE 
    r RECORD;
BEGIN
    FOR r IN 
        (SELECT tablename FROM pg_tables WHERE schemaname = 'test1') 
    LOOP
        EXECUTE format('INSERT INTO test2.%I SELECT * FROM test1.%I', r.tablename, r.tablename);
    END LOOP;
END $$;
