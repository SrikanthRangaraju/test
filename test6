#!/bin/bash

# Define source and destination folders
source_folder="/tmp/test/RutResponse"
destination_folder="/tmp/test/updatedfolder"

# Ensure the destination folder exists
mkdir -p "$destination_folder"

# Process each JSON file in the source folder
find "$source_folder" -type f -name "*.json" | while read -r file; do
  # Get the filename without the path
  filename=$(basename "$file")

  # Process the file: remove first and last lines and replace "response": { with {
  sed '1d;$d;s/"response": {/ {/' "$file" > "$destination_folder/$filename"
done

# Zip the updated folder
zip_file="${destination_folder}.zip"
echo "Zipping updated folder into $zip_file"
zip -r "$zip_file" "$destination_folder"

# Check if the zip command succeeded
if [ $? -eq 0 ]; then
  echo "Processing and zipping complete. Zip file: $zip_file"
else
  echo "Error: Failed to create zip file."
  exit 1
fi
