WITH common_ruts AS (
  -- Get RUTs present in ALL 6 tables for the date 202311
  SELECT rut FROM chile_bic WHERE date = 202311
  INTERSECT
  SELECT rut FROM chile_mcc WHERE date = 202311
  INTERSECT
  SELECT rut FROM chile_mtu WHERE date = 202311
  INTERSECT
  SELECT rut FROM attr_bic WHERE date = 202311
  INTERSECT
  SELECT rut FROM attr_mcc WHERE date = 202311
  INTERSECT
  SELECT rut FROM attr_mtu WHERE date = 202311
)

SELECT
  ab.bic_cant_doc_3um,
  am.mcc_cant_doc_3um,
  am.mcc_avg_monto,
  am.mcc_max_monto,
  amt.mtu_cant_doc_3um
FROM common_ruts cr
JOIN attr_bic ab 
  ON cr.rut = ab.rut 
  AND ab.date = 202311  -- Filter attr_bic by date
JOIN attr_mcc am 
  ON cr.rut = am.rut 
  AND am.date = 202311  -- Filter attr_mcc by date
JOIN attr_mtu amt 
  ON cr.rut = amt.rut 
  AND amt.date = 202311; -- Filter attr_mtu by date
