#!/bin/bash

# Define source and destination folders
source_folder="/tmp/test/RutResponse"
destination_folder="/tmp/test/updatedfolder"

# Ensure the destination folder exists
mkdir -p "$destination_folder"

# Process each JSON file in the source folder
find "$source_folder" -type f -name "*.json" | while read -r file; do
  # Get the filename without the path
  filename=$(basename "$file")

  # Process the file: remove first and last lines and replace "response": { with {
  sed '1d;$d;s/"response": {/ {/' "$file" > "$destination_folder/$filename"
done

# Zip the updated folder
zip_file="${destination_folder}.zip"
echo "Zipping updated folder into $zip_file"
zip -r "$zip_file" "$destination_folder"

# Check if the zip command succeeded
if [ $? -eq 0 ]; then
  echo "Successfully created zip file: $zip_file"
  
  # Delete the updated folder
  echo "Deleting the folder: $destination_folder"
  rm -rf "$destination_folder"
  
  # Check if the folder was deleted successfully
  if [ $? -eq 0 ]; then
    echo "Successfully deleted the folder: $destination_folder"
  else
    echo "Error: Failed to delete the folder: $destination_folder"
    exit 1
  fi
else
  echo "Error: Failed to create zip file."
  exit 1
fi

echo "Processing, zipping, and cleanup complete."
