import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVParser;
import org.apache.commons.csv.CSVPrinter;
import org.apache.commons.csv.CSVRecord;

import java.io.*;
import java.util.HashMap;
import java.util.LinkedHashMap;
import java.util.Map;

public class ReplaceCSVHeadersWithValues {
    public static void main(String[] args) {
        // Input and output file paths
        String inputFilePath = "input.csv";  // Path to your input CSV file
        String outputFilePath = "output.csv";  // Path to save the updated CSV file

        // Map of column replacements (key: old column name, value: new column name)
        Map<String, String> columnReplacements = new HashMap<>();
        columnReplacements.put("ABC1", "ABC9");
        columnReplacements.put("XYZ4", "ZXCV");
        columnReplacements.put("NOT_IN_CSV", "NEW_COLUMN");

        int headersChangedCount = 0; // Counter for changed headers

        try (
            Reader reader = new FileReader(inputFilePath);
            Writer writer = new FileWriter(outputFilePath);
            CSVParser csvParser = new CSVParser(reader, CSVFormat.DEFAULT.withFirstRecordAsHeader());
            CSVPrinter csvPrinter = new CSVPrinter(writer, CSVFormat.DEFAULT)
        ) {
            // Get original header map
            Map<String, Integer> originalHeaders = csvParser.getHeaderMap();
            Map<String, String> newHeaders = new LinkedHashMap<>(); // Maintain order of headers

            // Create a lowercase map of the replacements for case-insensitive comparison
            Map<String, String> lowerCaseReplacements = new HashMap<>();
            for (Map.Entry<String, String> entry : columnReplacements.entrySet()) {
                lowerCaseReplacements.put(entry.getKey().toLowerCase(), entry.getValue());
            }

            // Log missing columns and replace headers case-insensitively
            for (String header : originalHeaders.keySet()) {
                String lowerHeader = header.toLowerCase();
                if (lowerCaseReplacements.containsKey(lowerHeader)) {
                    String newHeader = lowerCaseReplacements.get(lowerHeader);
                    newHeaders.put(header, newHeader); // Map original header to new header
                    System.out.println("Successfully changed header from \"" + header + "\" to \"" + newHeader + "\".");
                    headersChangedCount++;
                } else {
                    newHeaders.put(header, header); // Keep the original header if no replacement
                }
            }

            // Write the updated headers
            csvPrinter.printRecord(newHeaders.values());

            // Write the data rows with the updated header names
            for (CSVRecord record : csvParser) {
                for (String originalHeader : newHeaders.keySet()) {
                    csvPrinter.print(record.get(originalHeader));
                }
                csvPrinter.println();
            }

            System.out.println("Total number of headers changed: " + headersChangedCount);
            System.out.println("CSV column headers updated and saved to " + outputFilePath);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
