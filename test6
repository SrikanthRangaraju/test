#!/bin/bash

# Define the folder containing the JSON files
folder_path="/path/to/your/folder"

# Loop through all JSON files in the folder
find "$folder_path" -type f -name "*.json" | while read -r file; do
  echo "Processing file: $file"

  # Check if the file is not empty
  if [ -s "$file" ]; then
    # Remove the first and last lines and replace "response": { with {
    sed '1d;$d;s/"response": {/ {/' "$file" > "${file}.tmp"

    # If the sed command was successful, replace the original file
    if [ $? -eq 0 ]; then
      mv "${file}.tmp" "$file"
      echo "Processed: $file"
    else
      echo "Error processing: $file"
      rm -f "${file}.tmp"  # Remove the temporary file on failure
    fi
  else
    echo "Skipped empty file: $file"
  fi
done

# Generate a timestamp in the format ddmmyyyy_currenttime
timestamp=$(date +"%d%m%Y_%H%M%S")

# Zip the folder with the timestamp
zip -r "${folder_path}_${timestamp}.zip" "$folder_path"

echo "Processing and zipping complete. Output: ${folder_path}_${timestamp}.zip"
